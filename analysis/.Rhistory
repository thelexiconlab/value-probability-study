#install.packages("stringdist")
#install.packages("lmerTest")
#install.packages("sjPlot")
#install.packages("Hmisc")
#install.packages("psych")
#install.packages("data.table")
#install.packages("MuMIn")
library(tidyverse)
library(car)
library(readr)
library(ggplot2)
library(ggthemes)
library(stringdist)
library(lme4)
library(lmerTest)
library(sjPlot)
library(Hmisc)
library(psych)
library(broom)
library(data.table)
library(MuMIn)
sona_data = read_csv("../data/behavioral/connector-ap-sona.csv", col_types = cols(question_order = col_character(), race = col_character(), ethnicity = col_character(), hand = col_character(), alert = col_character(), anything_else = col_character(), english = col_character(), first_language = col_character(), age_learned = col_character()))
other_data = read_csv("../data/behavioral/connector-ap.csv", col_types = cols(question_order = col_character(), race = col_character(), ethnicity = col_character(), hand = col_character(), alert = col_character(), anything_else = col_character(), english = col_character(), first_language = col_character(), age_learned = col_character())) %>%
mutate(sona_id = 1) %>%
relocate(sona_id, .before = rt) %>%
relocate(anything_else, .before = first_language) %>%
mutate(education = str_extract(education, "\\d+\\.?\\d*") %>%
as.numeric())
data = bind_rows(sona_data, other_data)
trials = data %>%
filter(type_of_trial == "experiment")
insufficient_trials = trials %>%
group_by(subject) %>%
count() %>%
filter(n < 60)
trials = trials %>%
filter(!(subject %in% insufficient_trials$subject))
trials_comparison = trials
attn_checks = data %>%
filter(subject %in% trials$subject) %>%
filter(is_seen == 1) %>%
mutate(attn_corr = ifelse(is.na(response), 0, ifelse(stringdist(tolower(response), clue, method = "lv") < 2, 1, 0)))
subject_attn = attn_checks %>%
group_by(subject) %>%
summarise(n_correct = sum(attn_corr))
insufficient_attentions = subject_attn %>%
filter(n_correct < 6)
trials = trials %>%
filter(!(subject %in% insufficient_attentions$subject))
demo = data %>%
filter(subject %in% trials$subject) %>%
filter(type_of_trial == "demographics" | type_of_trial == "not_english")
# deal with age learned english
not_english = demo %>%
filter(!is.na(first_language))
first_language = not_english %>%
group_by(first_language) %>%
count()
age_learned = not_english %>%
mutate(clean_age_learned = str_extract(age_learned, "\\d+\\.?\\d*") %>%
as.numeric())
al_av = age_learned %>%
filter(!is.na(clean_age_learned)) %>%
summarise(age_learned_average = mean(clean_age_learned))
age_learned_av = al_av$age_learned_average[1]
al_sd = age_learned %>%
filter(!is.na(clean_age_learned)) %>%
summarise(age_learned_stdev = sd(clean_age_learned))
age_learned_sd = al_sd$age_learned_stdev[1]
over_age_4 = age_learned %>%
filter(clean_age_learned > 4)
n_over_age_4 = nrow(over_age_4)
trials = trials %>%
filter(!(subject %in% over_age_4$subject))
# final number subjects
n_subjects = nrow(trials %>%
group_by(subject) %>%
count())
# rest of demographics
age_gen_ed = demo %>%
filter(!is.na(age)) %>%
filter(!str_detect(education, "[^[:digit:].]"))
age_av = mean(age_gen_ed$age)
age_sd = sd(age_gen_ed$age)
education_av = mean(as.numeric(age_gen_ed$education))
education_sd = sd(as.numeric(age_gen_ed$education))
genders = age_gen_ed %>%
group_by(gender) %>%
count()
race = demo %>%
filter(!is.na(race)) %>%
group_by(race) %>%
count()
eth_hand_alert_eng = demo %>%
filter(!is.na(english))
ethnicity = eth_hand_alert_eng %>%
group_by(ethnicity) %>%
count()
hand = eth_hand_alert_eng %>%
group_by(hand) %>%
count()
alert = eth_hand_alert_eng %>%
group_by(alert) %>%
count()
english = eth_hand_alert_eng %>%
group_by(english) %>%
count()
acc_by_subject = trials %>%
group_by(subject) %>%
summarise(av_acc = mean(accuracy))
accuracy_av = mean(acc_by_subject$av_acc)
accuracy_sd = sd(acc_by_subject$av_acc)
acc_by_clues = trials %>%
group_by(clue_type) %>%
summarise(av_acc = mean(accuracy))
c = trials %>%
rowwise() %>%
mutate(comma_count = str_count(all_responses, ",") + 1) %>%
select(all_responses, comma_count)
n_words_av = mean(c$comma_count)
rt_av = mean(as.numeric(trials$rt))/1000
rt_sd = sd(as.numeric(trials$rt))/1000
# first we recompile english demographic data using trials_comparison
demo_comparison = data %>%
filter(subject %in% trials_comparison$subject) %>%
filter(type_of_trial == "demographics" | type_of_trial == "not_english")
not_english_comp = demo_comparison %>%
filter(!is.na(first_language))
age_learned_comp = not_english_comp %>%
mutate(clean_age_learned = str_extract(age_learned, "\\d+\\.?\\d*") %>%
as.numeric())
age_before_after = age_learned_comp %>%
select(subject, clean_age_learned) %>%
filter(!(is.na(clean_age_learned))) %>%
mutate(bfr_aft = ifelse(clean_age_learned < 5, "before", "after"))
# then we join average accuracy by subject with the groups they are in for when they learned english and how many attention checks they passed
trials_comparison = trials_comparison %>%
group_by(subject) %>%
summarise(avg_acc = mean(accuracy))
trials_comparison = left_join(trials_comparison, age_before_after, by = "subject") %>%
mutate(bfr_aft_all = ifelse(is.na(bfr_aft), "before", bfr_aft)) %>%
select(subject, avg_acc, bfr_aft_all)
trials_comparison = left_join(trials_comparison, subject_attn, by = "subject") %>%
filter(n_correct == 5 | n_correct == 6)
anova1 = aov(data = trials_comparison, avg_acc ~ bfr_aft_all * n_correct)
summary(anova1)
trials_comparison %>%
ggplot(aes(x = n_correct, y = avg_acc, group = bfr_aft_all, color = bfr_aft_all)) +
geom_bar(stat = "identity", position = "dodge") +
labs(x = "num correct", y = "avg accuracy", fill = "before/after")
trials = trials %>%
mutate(accessibility_categorical = ifelse(accessibility < mean(accessibility), "Low", "High"))
trials %>%
ggplot(aes(x = pragmatics, y = accuracy, group = accessibility_categorical, color = accessibility_categorical)) +
geom_smooth(method = "lm") +
theme_few()
# center/scale accessibility and pragmatics
# now 0 means mean value of A/P and scaling bring everything to z-scores
trials = trials %>%
mutate(center_a = as.numeric(scale(accessibility, center = TRUE, scale = TRUE)),
center_p = as.numeric(scale(pragmatics, center = TRUE, scale= TRUE)))
## partial model
glmer1 = glmer(data = trials, accuracy ~ center_p*center_a + (center_p |subject) + (center_p |words), family = "binomial")
## full model
#glmer1 = glmer(data = trials, accuracy ~ center_p*center_a + (center_p*center_a|subject) + (center_p*center_a|words), family = "binomial")
fixed_effects = fixef(glmer1)
probs = exp(fixed_effects)/(1+exp(fixed_effects))
summary(glmer1)
car::Anova(glmer1)
MuMIn::r.squaredGLMM(glmer1)
## plot predicted plot from model
sjPlot::plot_model(glmer1, type = "int") + theme_few()
x = trials %>%
separate(response, into = c("guess1", "guess2"), sep = ",") %>%
mutate(guess1 = gsub("[^a-zA-Z]", "", guess1)) %>%
mutate(guess1 = tolower(guess1)) %>%
mutate(guess2 = gsub("[^a-zA-Z]", "", guess2)) %>%
mutate(guess2 = tolower(guess2))
#left_join(visit_counts)
x_1 = x %>%
group_by(guess1, clue) %>%
count()
x_2 = x %>%
group_by(guess2,clue) %>%
count()
guessed_words = bind_rows(x_1, x_2) %>%
mutate(word = ifelse(!(is.na(guess1)), guess1, guess2)) %>%
group_by(word, clue) %>%
summarise(n = sum(n))
y = trials %>%
group_by(clue) %>%
count()
guessed_words = guessed_words %>%
mutate(probability = n/y$n[match(clue, y$clue)])
guess_accessibility = read_csv("../data/stimuli/guess_visit_counts.csv")
guessed_words = guessed_words %>%
left_join(guess_accessibility)
# conduct lmer with visit_counts predicting probability, random slopes and intercepts at the word level (since visit counts are for guesses not clues)
guessed_words %>%
ggplot(aes(x = visit_count, y = probability, group = budget, color = budget)) +
geom_smooth(method = "lm") +
theme_few()
models_2to16 = guessed_words %>% filter(budget < 16) %>%
group_by(budget) %>%
do(model = lmer(data = ., probability ~ visit_count + (visit_count|word)),
control = lmerControl(optimizer="bobyqa",optCtrl=list(maxfun=2000000)))
MuMIn::r.squaredGLMM(models_2to16$model[[3]])
summary(models_2to16$model[[3]])
summary(glmer1)
probs
MuMIn::r.squaredGLMM(models_2to16$model[[3]])
)
summary(models_2to16$model[[1]])
summary(models_2to16$model[[2]])
summary(models_2to16$model[[3]])
guessed_words = guessed_words %>%
left_join(guess_accessibility)
# conduct lmer with visit_counts predicting probability, random slopes and intercepts at the word level (since visit counts are for guesses not clues)
guessed_words %>%
ggplot(aes(x = visit_count, y = probability, group = budget, color = budget)) +
geom_smooth(method = "lm") +
theme_few()
models_2to16 = guessed_words %>% filter(budget < 33) %>%
group_by(budget) %>%
do(model = lmer(data = ., probability ~ visit_count + (visit_count|word)),
control = lmerControl(optimizer="bobyqa",optCtrl=list(maxfun=2000000)))
MuMIn::r.squaredGLMM(models_2to16$model[[3]])
summary(models_2to16$model[[1]])
summary(models_2to16$model[[2]])
summary(models_2to16$model[[3]])
summary(models_2to16$model[[4]])
summary(models_2to16$model[[5]])
summary(models_2to16$model[[5]])
summary(models_2to16$model[[4]])
summary(models_2to16$model[[1]])
summary(models_2to16$model[[2]])
summary(models_2to16$model[[3]])
summary(models_2to16$model[[4]])
summary(models_2to16$model[[5]])
guessed_words %>%
ggplot(aes(x = visit_count, y = probability, group = budget, color = budget)) +
geom_smooth(method = "lm") +
theme_few()
summary(glmer1)
#install.packages("stringdist")
#install.packages("lmerTest")
#install.packages("sjPlot")
#install.packages("Hmisc")
#install.packages("psych")
#install.packages("data.table")
#install.packages("MuMIn")
library(tidyverse)
library(car)
library(readr)
library(ggplot2)
library(ggthemes)
library(stringdist)
library(lme4)
library(lmerTest)
library(sjPlot)
library(Hmisc)
library(psych)
library(broom)
library(data.table)
library(MuMIn)
sona_data = read_csv("../data/behavioral/connector-ap-sona.csv", col_types = cols(question_order = col_character(), race = col_character(), ethnicity = col_character(), hand = col_character(), alert = col_character(), anything_else = col_character(), english = col_character(), first_language = col_character(), age_learned = col_character()))
other_data = read_csv("../data/behavioral/connector-ap.csv", col_types = cols(question_order = col_character(), race = col_character(), ethnicity = col_character(), hand = col_character(), alert = col_character(), anything_else = col_character(), english = col_character(), first_language = col_character(), age_learned = col_character())) %>%
mutate(sona_id = 1) %>%
relocate(sona_id, .before = rt) %>%
relocate(anything_else, .before = first_language) %>%
mutate(education = str_extract(education, "\\d+\\.?\\d*") %>%
as.numeric())
data = bind_rows(sona_data, other_data)
trials = data %>%
filter(type_of_trial == "experiment")
insufficient_trials = trials %>%
group_by(subject) %>%
count() %>%
filter(n < 60)
trials = trials %>%
filter(!(subject %in% insufficient_trials$subject))
trials_comparison = trials
attn_checks = data %>%
filter(subject %in% trials$subject) %>%
filter(is_seen == 1) %>%
mutate(attn_corr = ifelse(is.na(response), 0, ifelse(stringdist(tolower(response), clue, method = "lv") < 2, 1, 0)))
subject_attn = attn_checks %>%
group_by(subject) %>%
summarise(n_correct = sum(attn_corr))
insufficient_attentions = subject_attn %>%
filter(n_correct < 6)
trials = trials %>%
filter(!(subject %in% insufficient_attentions$subject))
demo = data %>%
filter(subject %in% trials$subject) %>%
filter(type_of_trial == "demographics" | type_of_trial == "not_english")
# deal with age learned english
not_english = demo %>%
filter(!is.na(first_language))
first_language = not_english %>%
group_by(first_language) %>%
count()
age_learned = not_english %>%
mutate(clean_age_learned = str_extract(age_learned, "\\d+\\.?\\d*") %>%
as.numeric())
al_av = age_learned %>%
filter(!is.na(clean_age_learned)) %>%
summarise(age_learned_average = mean(clean_age_learned))
age_learned_av = al_av$age_learned_average[1]
al_sd = age_learned %>%
filter(!is.na(clean_age_learned)) %>%
summarise(age_learned_stdev = sd(clean_age_learned))
age_learned_sd = al_sd$age_learned_stdev[1]
over_age_4 = age_learned %>%
filter(clean_age_learned > 4)
n_over_age_4 = nrow(over_age_4)
trials = trials %>%
filter(!(subject %in% over_age_4$subject))
# final number subjects
n_subjects = nrow(trials %>%
group_by(subject) %>%
count())
# rest of demographics
age_gen_ed = demo %>%
filter(!is.na(age)) %>%
filter(!str_detect(education, "[^[:digit:].]"))
age_av = mean(age_gen_ed$age)
age_sd = sd(age_gen_ed$age)
education_av = mean(as.numeric(age_gen_ed$education))
education_sd = sd(as.numeric(age_gen_ed$education))
genders = age_gen_ed %>%
group_by(gender) %>%
count()
race = demo %>%
filter(!is.na(race)) %>%
group_by(race) %>%
count()
eth_hand_alert_eng = demo %>%
filter(!is.na(english))
ethnicity = eth_hand_alert_eng %>%
group_by(ethnicity) %>%
count()
hand = eth_hand_alert_eng %>%
group_by(hand) %>%
count()
alert = eth_hand_alert_eng %>%
group_by(alert) %>%
count()
english = eth_hand_alert_eng %>%
group_by(english) %>%
count()
acc_by_subject = trials %>%
group_by(subject) %>%
summarise(av_acc = mean(accuracy))
accuracy_av = mean(acc_by_subject$av_acc)
accuracy_sd = sd(acc_by_subject$av_acc)
acc_by_clues = trials %>%
group_by(clue_type) %>%
summarise(av_acc = mean(accuracy))
c = trials %>%
rowwise() %>%
mutate(comma_count = str_count(all_responses, ",") + 1) %>%
select(all_responses, comma_count)
n_words_av = mean(c$comma_count)
rt_av = mean(as.numeric(trials$rt))/1000
rt_sd = sd(as.numeric(trials$rt))/1000
# first we recompile english demographic data using trials_comparison
demo_comparison = data %>%
filter(subject %in% trials_comparison$subject) %>%
filter(type_of_trial == "demographics" | type_of_trial == "not_english")
not_english_comp = demo_comparison %>%
filter(!is.na(first_language))
age_learned_comp = not_english_comp %>%
mutate(clean_age_learned = str_extract(age_learned, "\\d+\\.?\\d*") %>%
as.numeric())
age_before_after = age_learned_comp %>%
select(subject, clean_age_learned) %>%
filter(!(is.na(clean_age_learned))) %>%
mutate(bfr_aft = ifelse(clean_age_learned < 5, "before", "after"))
# then we join average accuracy by subject with the groups they are in for when they learned english and how many attention checks they passed
trials_comparison = trials_comparison %>%
group_by(subject) %>%
summarise(avg_acc = mean(accuracy))
trials_comparison = left_join(trials_comparison, age_before_after, by = "subject") %>%
mutate(bfr_aft_all = ifelse(is.na(bfr_aft), "before", bfr_aft)) %>%
select(subject, avg_acc, bfr_aft_all)
trials_comparison = left_join(trials_comparison, subject_attn, by = "subject") %>%
filter(n_correct == 5 | n_correct == 6)
anova1 = aov(data = trials_comparison, avg_acc ~ bfr_aft_all * n_correct)
summary(anova1)
trials_comparison %>%
ggplot(aes(x = n_correct, y = avg_acc, group = bfr_aft_all, color = bfr_aft_all)) +
geom_bar(stat = "identity", position = "dodge") +
labs(x = "num correct", y = "avg accuracy", fill = "before/after")
trials = trials %>%
mutate(accessibility_categorical = ifelse(accessibility < mean(accessibility), "Low", "High"))
trials %>%
ggplot(aes(x = pragmatics, y = accuracy, group = accessibility_categorical, color = accessibility_categorical)) +
geom_smooth(method = "lm") +
theme_few()
# center/scale accessibility and pragmatics
# now 0 means mean value of A/P and scaling bring everything to z-scores
trials = trials %>%
mutate(center_a = as.numeric(scale(accessibility, center = TRUE, scale = TRUE)),
center_p = as.numeric(scale(pragmatics, center = TRUE, scale= TRUE)))
## partial model
glmer1 = glmer(data = trials, accuracy ~ center_p*center_a + (center_p |subject) + (center_p |words), family = "binomial")
## full model
#glmer1 = glmer(data = trials, accuracy ~ center_p*center_a + (center_p*center_a|subject) + (center_p*center_a|words), family = "binomial")
fixed_effects = fixef(glmer1)
probs = exp(fixed_effects)/(1+exp(fixed_effects))
summary(glmer1)
car::Anova(glmer1)
MuMIn::r.squaredGLMM(glmer1)
## plot predicted plot from model
sjPlot::plot_model(glmer1, type = "int") + theme_few()
x = trials %>%
separate(response, into = c("guess1", "guess2"), sep = ",") %>%
mutate(guess1 = gsub("[^a-zA-Z]", "", guess1)) %>%
mutate(guess1 = tolower(guess1)) %>%
mutate(guess2 = gsub("[^a-zA-Z]", "", guess2)) %>%
mutate(guess2 = tolower(guess2))
#left_join(visit_counts)
x_1 = x %>%
group_by(guess1, clue) %>%
count()
x_2 = x %>%
group_by(guess2,clue) %>%
count()
guessed_words = bind_rows(x_1, x_2) %>%
mutate(word = ifelse(!(is.na(guess1)), guess1, guess2)) %>%
group_by(word, clue) %>%
summarise(n = sum(n))
y = trials %>%
group_by(clue) %>%
count()
guessed_words = guessed_words %>%
mutate(probability = n/y$n[match(clue, y$clue)])
guess_accessibility = read_csv("../data/stimuli/guess_visit_counts.csv")
guessed_words = guessed_words %>%
left_join(guess_accessibility)
# conduct lmer with visit_counts predicting probability, random slopes and intercepts at the word level (since visit counts are for guesses not clues)
guessed_words %>%
ggplot(aes(x = visit_count, y = probability, group = budget, color = budget)) +
geom_smooth(method = "lm") +
theme_few()
models_2to16 = guessed_words %>% filter(budget < 33) %>%
group_by(budget) %>%
do(model = lmer(data = ., probability ~ visit_count + (visit_count|word)),
control = lmerControl(optimizer="bobyqa",optCtrl=list(maxfun=2000000)))
MuMIn::r.squaredGLMM(models_2to16$model[[3]])
summary(models_2to16$model[[1]])
summary(models_2to16$model[[2]])
summary(models_2to16$model[[3]])
summary(models_2to16$model[[4]])
summary(models_2to16$model[[5]])
summary(glmer1)
sjPlot::plot_model(glmer1, type = "int") + theme_few()
sd(trials$center_a)
View(acc_by_clues)
trials = trials %>%
mutate(pragmatics_categorical = ifelse(pragmatics < mean(pragmatics), "Low", "High"))
trials %>%
ggplot(aes(x = accessibility, y = accuracy, group = pragmatics_categorical, color = pragmatics_categorical)) +
geom_smooth(method = "lm") +
theme_few()
trials %>%
ggplot(aes(x = accessibility, y = accuracy)) +
geom_smooth(method = "lm") +
theme_few()
trials %>%
ggplot(aes(x = pragmatics, y = accuracy, group = accessibility_categorical, color = accessibility_categorical)) +
geom_smooth(method = "lm") +
theme_few()
sjPlot::plot_model(glmer1, type = "int") +
xlab("Pragmatics") +
ylab("Accuracy") +
legend("Accessibility")
sjPlot::plot_model(glmer1, type = "int") +
xlab("Pragmatics") +
ylab("Accuracy") +
legend("Accessibility") +
theme_few()
sjPlot::plot_model(glmer1, type = "int") +
xlab("Pragmatics") +
ylab("Accuracy") +
legend.title("Accessibility") +
theme_few()
sjPlot::plot_model(glmer1, type = "int", legend.title = "Accessibility") +
xlab("Pragmatics") +
ylab("Accuracy") +
theme_few()
guessed_words %>%
ggplot(aes(x = visit_count, y = probability, group = as.factor(budget), color = as.factor(budget))) +
geom_smooth(method = "lm") +
theme_few()
guessed_words %>%
ggplot(aes(x = visit_count, y = probability, group = as.factor(budget), color = as.factor(budget))) +
geom_smooth(method = "lm") +
xlab("Accessibility") +
ylab("Guess Probability")
guessed_words %>%
ggplot(aes(x = visit_count, y = probability, group = as.factor(budget), color = as.factor(budget))) +
geom_smooth(method = "lm") +
xlab("Accessibility") +
ylab("Guess Probability") +
theme_few()
guessed_words %>%
ggplot(aes(x = visit_count, y = probability, group = as.factor(budget), color = as.factor(budget))) +
geom_smooth(method = "lm") +
labs(x = "Accessibility", y = "Guess Probability", color = "Budget") +
theme_few()
